var SpeakingFlags;class BoundedHistogram{constructor(s){this.size=s,this.head=0,this.samples=Array(s).fill(0)}addSample(s){this.head=(this.head+1)%this.size,this.samples[this.head]=s}mean(){let s=0,e=1/this.size;for(let t of this.samples)s+=t*e;return s}}!function(s){s[s.NONE=0]="NONE",s[s.VOICE=1]="VOICE",s[s.SOUNDSHARE=2]="SOUNDSHARE",s[s.PRIORITY=4]="PRIORITY"}(SpeakingFlags||(SpeakingFlags={}));let NO_AUDIO_INPUT_THRESHOLD_DBFS=-80;if("undefined"!=typeof AudioWorkletProcessor){class s extends AudioWorkletProcessor{constructor(){super(),this.running=!0,this.lastSpeaking=SpeakingFlags.NONE,this.dBFSHistogram=new BoundedHistogram(20),this.port.onmessage=s=>{"close"===s.data&&(this.running=!1)}}process(s,e,t){let i=s[0],a=SpeakingFlags.NONE;if(i.length>0&&i[0].length>0){let s=i[0].length,e=0;for(let s=0;s<i.length;++s){let t=i[s];for(let s=0;s<t.length;++s)e+=t[s]*t[s]}e=20*Math.log10(Math.sqrt(e/(s*i.length)))+Math.sqrt(2),this.dBFSHistogram.addSample(e>-100?e:-100),a=this.dBFSHistogram.mean()>-80?SpeakingFlags.VOICE:SpeakingFlags.NONE}return this.lastSpeaking!==a&&(this.port.postMessage(a),this.lastSpeaking=a),this.running}}registerProcessor("level-processor",s)}